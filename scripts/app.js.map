{"version":3,"sources":["app/app.module.coffee","app/cozydb-browser.js","app/scripts/Home.Ctrl.coffee"],"names":[],"mappings":"AAAA;;AAAA,EAA4B,CAAhB,MAAZ,IAAY;CACV;AAAA;CACE,MAAO;CAAP,CAC0B,EAA1B,OAAsC,GAAxB;CAFhB;CAAA,CAGA,YAAc;CAAW,CAAY,CAAZ;CAHzB,GAGA;CAHA,CAIA,KAAO,KAAP;CALU;;AAQZ,CARA,CAQ6B,IAA7B,CAAO,EAAsB,GAA7B;;AAIA,CAZA,EAYc,QAAd;CAAc;CACZ,CAAa,EAAb;CAAA,CACY,EAAZ,SADA;CAAA,CAEc,EAAd,EAFA,MAEA;GAHY;CAZd;;AAgBA,CAhBA,CAkBE,CAFkB,IAApB,EAAS,MAAW;CChBpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrfA;;AAAA,EAAuB,CAAT,MAAC,CAAD,CAAd;CACE;CAAA,EAAK,CAAL;CAAA,CAEA,EAAM,KAAC;CACL;CAAA,MAAO,SAAP;CAAA,CAEE,CADQ,CAAV,EAAgB,CAAhB,CAAU;CACR;CAAA,CACG,IAAH;CADA,CAEK,CAAL;CAFA,CAGO,GAAP;CAHA,CAIY,IAAZ;CAJA,CAKM,EAAN;CALA,CAMU,IAAV;CANA,CAOK,CAAL;CAPA,CAQM,EAAN;CAVF,KACU;CADV,CAWqB,EAArB,GAAO,EAAe;CACpB,GAAG,EAAH;CACE;MADF;CAGE,MAAO,CAAP;CAAA,EACA,IAAO,CAAP;CADA,CAEmB,CAAN,CAAb,GAAO,CAAP,CAAc;CACZ,MAAO,GAAP;CAAA,EACA,IAAO,CAAP;CADA,EAEA,IAAO,GAAP;CAHF,QAAa;CAFb,EAOc,GAAR,EAAN,CAAc;CACZ,EAAkB,GAAZ,EAAN;CAAA,CACE,CAAY,KAAd;CAFF,QAAc;OAXG;CAArB,IAAqB;CAXrB,EA2BA,IAAO,MAAP;CA9BF,EAEM;CAFN,CAiCA;CAlCY;;AAqCd,CArCA,CAqCuD,IAAvD,CAAO,GAAP;;AACA,CAtCA,CAwCE,CAFoB,IAAtB,CAAsB,GAAX,CAAW","file":"scripts/app.js","sourcesContent":["appConfig = ($httpProvider, $routeProvider) ->\n  for path of routeObject\n    console.log path\n    $routeProvider.when path, routeObject[path]\n  $routeProvider.otherwise redirectTo: '/'\n  console.log 'app config'\n  return\n\nangular.module('browserapp', [\n  'ngResource'\n  'ngRoute'\n]).config appConfig\nrouteObject = '/':\n  templateUrl: 'partials/home.html'\n  controller: 'HomeAngCtrl'\n  controllerAs: 'home'\nappConfig.$inject = [\n  '$httpProvider'\n  '$routeProvider'\n]","(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.cozydb = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n// Generated by CoffeeScript 1.10.0\n(function() {\n  var CozyBackedModel, Model, client, cozyDataAdapter,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  client = require('./utils/client');\n\n  Model = require('./model');\n\n  cozyDataAdapter = {\n    find: function(id, callback) {\n      return client.get(\"data/\" + id + \"/\", function(error, response) {\n        if (error) {\n          return callback(error);\n        } else if (response.statusCode === 404) {\n          return callback(null, null);\n        } else {\n          return callback(null, response);\n        }\n      });\n    },\n    create: function(attributes, callback) {\n      var path;\n      path = \"data/\";\n      if (attributes.id != null) {\n        path += attributes.id + \"/\";\n        delete attributes.id;\n        return callback(new Error('cant create an object with a set id'));\n      }\n      return client.post(path, attributes, function(error, response) {\n        if (error) {\n          return callback(error);\n        } else if (response.statusCode === 409) {\n          return callback(new Error(\"This document already exists\"));\n        } else if (response.statusCode !== 201) {\n          return callback(new Error(\"Server error occured.\"));\n        } else {\n          response.id = response._id;\n          return callback(null, body);\n        }\n      });\n    }\n  };\n\n  module.exports = CozyBackedModel = (function(superClass) {\n    extend(CozyBackedModel, superClass);\n\n    function CozyBackedModel() {\n      return CozyBackedModel.__super__.constructor.apply(this, arguments);\n    }\n\n    CozyBackedModel.adapter = cozyDataAdapter;\n\n    CozyBackedModel.cast = function() {\n      if (!this.__addedToSchema) {\n        this.__addedToSchema = true;\n        this.schema._id = String;\n        this.schema._attachments = Object;\n        this.schema._rev = String;\n        this.schema.id = String;\n        this.schema.docType = String;\n      }\n      return CozyBackedModel.__super__.constructor.cast.apply(this, arguments);\n    };\n\n    return CozyBackedModel;\n\n  })(Model);\n\n}).call(this);\n\n},{\"./model\":3,\"./utils/client\":4}],2:[function(require,module,exports){\n// Generated by CoffeeScript 1.10.0\n(function() {\n  var CozyModel, Model, NoSchema,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module.exports.Model = Model = require('./model');\n\n  module.exports.CozyModel = CozyModel = require('./cozymodel');\n\n  NoSchema = require('./utils/type_checking').NoSchema;\n\n  module.exports.NoSchema = NoSchema;\n\n  module.exports.getModel = function(name, schema) {\n    var ClassFromGetModel, klass;\n    window.parent.postMessage({\n      action: 'getToken'\n    }, '*');\n    klass = ClassFromGetModel = (function(superClass) {\n      extend(ClassFromGetModel, superClass);\n\n      function ClassFromGetModel() {\n        return ClassFromGetModel.__super__.constructor.apply(this, arguments);\n      }\n\n      ClassFromGetModel.schema = schema;\n\n      return ClassFromGetModel;\n\n    })(CozyModel);\n    klass.displayName = klass.name = name;\n    klass.toString = function() {\n      return name + \"Constructor\";\n    };\n    klass.docType = name;\n    return klass;\n  };\n\n}).call(this);\n\n},{\"./cozymodel\":1,\"./model\":3,\"./utils/type_checking\":5}],3:[function(require,module,exports){\n// Generated by CoffeeScript 1.10.0\n(function() {\n  var Model, castObject,\n    hasProp = {}.hasOwnProperty;\n\n  Model = (function() {\n    Model.getDocType = function() {\n      var ref;\n      return ((ref = this.docType) != null ? ref.toLowerCase() : void 0) || this.name.toLowerCase();\n    };\n\n    Model.find = function(id, callback) {\n      return this.adapter.find(id, (function(_this) {\n        return function(err, attributes) {\n          var ref;\n          if (err) {\n            return callback(err);\n          } else if ((attributes != null ? (ref = attributes.docType) != null ? ref.toLowerCase() : void 0 : void 0) !== _this.getDocType()) {\n            return callback(null, null);\n          } else {\n            return callback(null, new _this(attributes));\n          }\n        };\n      })(this));\n    };\n\n    Model.create = function(data, callback) {\n      data.docType = this.getDocType();\n      data = this.cast(data);\n      return this.adapter.create(data, (function(_this) {\n        return function(err, attributes) {\n          var k, v;\n          if (err) {\n            return callback(err);\n          }\n          for (k in attributes) {\n            v = attributes[k];\n            data[k] = v;\n          }\n          return callback(null, new _this(data));\n        };\n      })(this));\n    };\n\n    Model.cast = function(attributes, target) {\n      if (target == null) {\n        target = {};\n      }\n      return castObject(attributes, this.schema, target, this.name);\n    };\n\n    Model.defineRequest = function(name, request, callback) {\n      var map, reduce;\n      if (typeof request === \"function\" || typeof request === 'string') {\n        map = request;\n      } else {\n        map = request.map;\n        reduce = request.reduce;\n      }\n      return this.requestsAdapter.define.call(this, name, {\n        map: map,\n        reduce: reduce\n      }, callback);\n    };\n\n    function Model(attributes) {\n      if (attributes == null) {\n        attributes = {};\n      }\n      this.constructor.cast(attributes, this);\n      if (attributes._id) {\n        if (this.id == null) {\n          this.id = attributes._id;\n        }\n      }\n      ({\n        getAttributes: function() {\n          var key, out, value;\n          out = {};\n          for (key in this) {\n            if (!hasProp.call(this, key)) continue;\n            value = this[key];\n            out[key] = value;\n          }\n          return out;\n        }\n      });\n    }\n\n    Model.prototype.toJSON = function() {\n      return this.getAttributes();\n    };\n\n    Model.prototype.toObject = function() {\n      return this.getAttributes();\n    };\n\n    Model.prototype.toString = function() {\n      return this.constructor.getDocType() + JSON.stringify(this.toJSON());\n    };\n\n    return Model;\n\n  })();\n\n  module.exports = Model;\n\n  castObject = require('./utils/type_checking').castObject;\n\n}).call(this);\n\n},{\"./utils/type_checking\":5}],4:[function(require,module,exports){\n// Generated by CoffeeScript 1.10.0\n(function() {\n  module.exports = {\n    get: function(path, callback) {\n      var xhr;\n      xhr = new XMLHttpRequest;\n      xhr.open('GET', '/ds-api/#{path}/', true);\n      xhr.onload = function() {\n        callback(null, xhr.response);\n      };\n      xhr.onerror = function(e) {\n        var err;\n        err = 'Request failed : #{e.target.status}';\n        callback(err);\n      };\n      xhr.setRequestHeader('Content-Type', 'application/json');\n      return xhr.send();\n    },\n    post: function(path, attributes, callback) {\n      var location, xhr;\n      location = window.location;\n      xhr = new XMLHttpRequest;\n      xhr.open('POST', \"/ds-api/\" + path, true);\n      xhr.onload = function() {\n        callback(null, xhr.response);\n      };\n      xhr.onerror = function(e) {\n        var err;\n        err = 'Request failed : #{e.target.status}';\n        callback(err);\n      };\n      return window.addEventListener('message', (function(event) {\n        var intent, requestHeader;\n        intent = event.data;\n        xhr.setRequestHeader('Content-Type', 'application/json');\n        requestHeader = 'Basic ' + btoa(intent.appName + \":\" + intent.token);\n        xhr.setRequestHeader('Authorization', requestHeader);\n        xhr.send(JSON.stringify(attributes));\n      }), true);\n    }\n  };\n\n}).call(this);\n\n},{}],5:[function(require,module,exports){\n(function (process){\n// Generated by CoffeeScript 1.10.0\n(function() {\n  var Model, NoSchema, _default, _isArray, _isMap, _toString, castObject, castValue, ref, reportCastIgnore,\n    hasProp = {}.hasOwnProperty,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  _toString = function(x) {\n    return Object.prototype.toString.call(x);\n  };\n\n  _isArray = Array.isArray || function(x) {\n    return '[object Array]' === _toString(x);\n  };\n\n  _isMap = function(x) {\n    return '[object Object]' === _toString(x);\n  };\n\n  _default = function(value, defaultValue, lastDefault) {\n    if (value !== void 0) {\n      return value;\n    } else if (defaultValue !== void 0) {\n      return defaultValue;\n    } else {\n      return lastDefault;\n    }\n  };\n\n  exports.NoSchema = NoSchema = {\n    symbol: 'NoSchema'\n  };\n\n  exports.castValue = castValue = function(value, typeOrOptions) {\n    var arrayType, defaultValue, i, item, key, len, out, pvalue, result, type;\n    if (typeOrOptions.type) {\n      type = typeOrOptions.type;\n      defaultValue = typeOrOptions['default'];\n    } else {\n      type = typeOrOptions;\n      defaultValue = void 0;\n    }\n    if (value === void 0 || value === null) {\n      if (_isArray(type)) {\n        return [];\n      } else {\n        return defaultValue;\n      }\n    }\n    if (type === NoSchema) {\n      out = value;\n    } else if (type === Date) {\n      value = _default(value, defaultValue, void 0);\n      out = new Date(value);\n    } else if (type === String) {\n      value = _default(value, defaultValue, void 0);\n      out = String(value);\n    } else if (type === Boolean) {\n      value = _default(value, defaultValue, void 0);\n      out = Boolean(value);\n    } else if (type === Number) {\n      value = _default(value, defaultValue, void 0);\n      out = Number(value);\n    } else if (type === Object) {\n      out = {};\n      for (key in value) {\n        if (!hasProp.call(value, key)) continue;\n        pvalue = value[key];\n        out[key] = pvalue;\n      }\n    } else if (type.prototype instanceof Model) {\n      out = type.cast(value);\n    } else if (_isArray(type)) {\n      if (!type[0]) {\n        throw WrongShemaError('empty array');\n      }\n      value = _default(value, defaultValue, []);\n      arrayType = type[0];\n      result = [];\n      if ((value != null) && typeof value !== 'string') {\n        for (i = 0, len = value.length; i < len; i++) {\n          item = value[i];\n          result.push(castValue(item, arrayType));\n        }\n      }\n      return result;\n    } else if (typeof type === 'function') {\n      return type(value);\n    } else {\n      throw WrongShemaError(\"unsuported type \", type);\n    }\n    return out;\n  };\n\n  reportCastIgnore = ((ref = process.env.NODE_ENV) !== 'production' && ref !== 'test') || process.env.NO_CAST_WARNING;\n\n  exports.castObject = castObject = function(raw, schema, target, name) {\n    var handled, prop, typeOrOptions, value;\n    if (target == null) {\n      target = {};\n    }\n    handled = [];\n    if (schema === NoSchema) {\n      for (prop in raw) {\n        value = raw[prop];\n        target[prop] = value;\n      }\n      return target;\n    }\n    for (prop in schema) {\n      if (!hasProp.call(schema, prop)) continue;\n      typeOrOptions = schema[prop];\n      target[prop] = castValue(raw[prop], typeOrOptions);\n      if (reportCastIgnore) {\n        handled.push(prop);\n      }\n    }\n    if (reportCastIgnore) {\n      for (prop in raw) {\n        if (!hasProp.call(raw, prop)) continue;\n        value = raw[prop];\n        if (indexOf.call(handled, prop) < 0) {\n          log.warn(\"Warning : cast ignored property '\" + prop + \"' on '\" + name + \"'\");\n        }\n      }\n      return target;\n    }\n  };\n\n  Model = require('../model');\n\n}).call(this);\n\n}).call(this,require('_process'))\n},{\"../model\":3,\"_process\":6}],6:[function(require,module,exports){\n// shim for using process in browser\n\nvar process = module.exports = {};\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = setTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    clearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        setTimeout(drainQueue, 0);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n},{}]},{},[2])(2)\n});","HomeAngCtrl = ($scope, $injector, $rootScope, $q) ->\n  vm = this\n\n  add = (user) ->\n    console.log 'create contact'\n    Contact = cozydb.getModel('Contact',\n      fn: String\n      n: String\n      org: String\n      title: String\n      department: String\n      bday: String\n      nickname: String\n      url: String\n      note: String)\n    Contact.create user, (err, res) ->\n      if err\n        alert err\n      else\n        console.log 'Contact.create'\n        console.log res\n        Contact.find (err, response) ->\n          console.log '//////////////////'\n          console.log response\n          console.log '//////////////////'\n          return\n        $scope.$apply ->\n          $scope.contacts = res\n          vm.contacts = res\n          return\n      return\n    console.log 'END CONTACT'\n    return\n\n  vm.add = add\n  return\n\nangular.module('browserapp').controller 'HomeAngCtrl', HomeAngCtrl\nHomeAngCtrl.$inject = [\n  '$scope'\n  '$injector'\n  '$rootScope'\n  '$q'\n]"]}